<div th:fragment="contenido">
  <h4>Registrar Historial Clínico</h4>

  <form th:action="${modo == 'editar'} ? @{/save-edit-historial} : @{/guardar-historial}"
        th:object="${historial}" method="post" class="row g-3">

    <input type="hidden" th:field="*{id}">
    <input type="hidden" th:field="*{cita.id}"> <!-- Importante: vincular con la cita -->

    <div class="col-md-6">
      <label class="form-label">Paciente</label>
      <input type="text" class="form-control" th:value="${historial.cita.paciente.nombres + ' ' + historial.cita.paciente.apellidos}" disabled>
      <input type="hidden" th:field="*{paciente.id}"> <!-- para enviar el id -->
    </div>

    <div class="col-md-6">
      <label class="form-label">Médico</label>
      <input type="text" class="form-control" th:value="${historial.cita.medico.nombres + ' ' + historial.cita.medico.apellidos}" disabled>
      <input type="hidden" th:field="*{medico.id}">
    </div>

    <div class="col-md-6">
      <label class="form-label">Fecha de Atención</label>
      <input type="date" th:field="*{fecha}" class="form-control" required>
    </div>

    <div class="col-12">
      <label class="form-label">Diagnóstico</label>
      <textarea th:field="*{diagnostico}" class="form-control" rows="3" required></textarea>
    </div>

    <div class="col-12">
      <label class="form-label">Tratamiento</label>
      <textarea th:field="*{tratamiento}" class="form-control" rows="3" required></textarea>
    </div>

    <div class="col-12">
      <label class="form-label">Observaciones</label>
      <textarea th:field="*{observaciones}" class="form-control" rows="3"></textarea>
    </div>

    <div class="col-12">
      <button type="submit" class="btn btn-primary">Guardar Historial</button>
      <a th:href="@{/list-historial}" class="btn btn-secondary">Ver Lista</a>
    </div>

  </form>
</div>
